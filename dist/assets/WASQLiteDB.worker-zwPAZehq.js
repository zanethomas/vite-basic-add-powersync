let Rn,F,Cn,Pn,Fn,vn,Qn,Hn,Vn,Wn,zn,Ln,Bn,Dn,Un,$n,Gn,Kn,jn;let __tla=(async()=>{const nn=Symbol("Comlink.proxy"),fn=Symbol("Comlink.endpoint"),ln=Symbol("Comlink.releaseProxy"),D=Symbol("Comlink.finalizer"),P=Symbol("Comlink.thrown"),tn=e=>typeof e=="object"&&e!==null||typeof e=="function",_n={canHandle:e=>tn(e)&&e[nn],serialize(e){const{port1:n,port2:i}=new MessageChannel;return V(e,n),[i,[i]]},deserialize(e){return e.start(),pn(e)}},hn={canHandle:e=>tn(e)&&P in e,serialize({value:e}){let n;return e instanceof Error?n={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:n={isError:!1,value:e},[n,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},en=new Map([["proxy",_n],["throw",hn]]);function mn(e,n){for(const i of e)if(n===i||i==="*"||i instanceof RegExp&&i.test(n))return!0;return!1}function V(e,n=globalThis,i=["*"]){n.addEventListener("message",function h(a){if(!a||!a.data)return;if(!mn(i,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:b,type:p,path:g}=Object.assign({path:[]},a.data),y=(a.data.argumentList||[]).map(O);let w;try{const f=g.slice(0,-1).reduce((E,d)=>E[d],e),l=g.reduce((E,d)=>E[d],e);switch(p){case"GET":w=l;break;case"SET":f[g.slice(-1)[0]]=O(a.data.value),w=!0;break;case"APPLY":w=l.apply(f,y);break;case"CONSTRUCT":{const E=new l(...y);w=x(E)}break;case"ENDPOINT":{const{port1:E,port2:d}=new MessageChannel;V(e,d),w=En(E,[E])}break;case"RELEASE":w=void 0;break;default:return}}catch(f){w={value:f,[P]:0}}Promise.resolve(w).catch(f=>({value:f,[P]:0})).then(f=>{const[l,E]=B(f);n.postMessage(Object.assign(Object.assign({},l),{id:b}),E),p==="RELEASE"&&(n.removeEventListener("message",h),rn(n),D in e&&typeof e[D]=="function"&&e[D]())}).catch(f=>{const[l,E]=B({value:new TypeError("Unserializable return value"),[P]:0});n.postMessage(Object.assign(Object.assign({},l),{id:b}),E)})}),n.start&&n.start()}function wn(e){return e.constructor.name==="MessagePort"}function rn(e){wn(e)&&e.close()}function pn(e,n){return H(e,[],n)}function C(e){if(e)throw new Error("Proxy has been released and is not useable")}function sn(e){return N(e,{type:"RELEASE"}).then(()=>{rn(e)})}const Q=new WeakMap,U="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const n=(Q.get(e)||0)-1;Q.set(e,n),n===0&&sn(e)});function gn(e,n){const i=(Q.get(n)||0)+1;Q.set(n,i),U&&U.register(e,n,e)}function bn(e){U&&U.unregister(e)}function H(e,n=[],i=function(){}){let h=!1;const a=new Proxy(i,{get(b,p){if(C(h),p===ln)return()=>{bn(a),sn(e),h=!0};if(p==="then"){if(n.length===0)return{then:()=>a};const g=N(e,{type:"GET",path:n.map(y=>y.toString())}).then(O);return g.then.bind(g)}return H(e,[...n,p])},set(b,p,g){C(h);const[y,w]=B(g);return N(e,{type:"SET",path:[...n,p].map(f=>f.toString()),value:y},w).then(O)},apply(b,p,g){C(h);const y=n[n.length-1];if(y===fn)return N(e,{type:"ENDPOINT"}).then(O);if(y==="bind")return H(e,n.slice(0,-1));const[w,f]=G(g);return N(e,{type:"APPLY",path:n.map(l=>l.toString()),argumentList:w},f).then(O)},construct(b,p){C(h);const[g,y]=G(p);return N(e,{type:"CONSTRUCT",path:n.map(w=>w.toString()),argumentList:g},y).then(O)}});return gn(a,e),a}function yn(e){return Array.prototype.concat.apply([],e)}function G(e){const n=e.map(B);return[n.map(i=>i[0]),yn(n.map(i=>i[1]))]}const cn=new WeakMap;function En(e,n){return cn.set(e,n),e}function x(e){return Object.assign(e,{[nn]:!0})}function B(e){for(const[n,i]of en)if(i.canHandle(e)){const[h,a]=i.serialize(e);return[{type:"HANDLER",name:n,value:h},a]}return[{type:"RAW",value:e},cn.get(e)||[]]}function O(e){switch(e.type){case"HANDLER":return en.get(e.name).deserialize(e.value);case"RAW":return e.value}}function N(e,n,i){return new Promise(h=>{const a=dn();e.addEventListener("message",function b(p){!p.data||!p.data.id||p.data.id!==a||(e.removeEventListener("message",b),h(p.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:a},n),i)})}function dn(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let I,W,Tn,z,on,qn,K,j,$,X,Y;F=0;vn=5;Rn=10;Cn=12;Pn=14;I=21;W=25;Tn=27;z=100;on=101;Qn=3850;Un=522;Bn=1;qn=2;Ln=4;Dn=8;Fn=0;Wn=1;Hn=2;zn=3;Vn=4;Gn=512;Kn=1024;jn=2048;$n=16384;K=1;j=2;$=3;X=4;Y=5;typeof BigInt.prototype.toJSON>"u"&&(BigInt.prototype.toJSON=function(){return this.toString()});const J=0x7fffffffffffffffn,Z=-0x8000000000000000n;class A extends Error{constructor(n,i){super(n),this.code=i}}const k=!0,an={};globalThis.__onTablesChanged=function(e,n,i,h){setTimeout(()=>an[e]?.(n,i,h),0)};function Sn(e){const n={},i=e._getSqliteFree(),h=e._malloc(8),a=[h,h+4];function b(s){if(typeof s!="string")return 0;const r=e.lengthBytesUTF8(s),t=e._sqlite3_malloc(r+1);return e.stringToUTF8(s,t,r+1),t}function p(s,r){return BigInt(r)<<32n|BigInt(s)&4294967295n}const g=function(){const s=BigInt(Number.MAX_SAFE_INTEGER)>>32n,r=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(t,c){return c>s||c<r?p(t,c):c*4294967296+(t&2147483647)-(t&2147483648)}}(),y=new Set;function w(s){if(!y.has(s))throw new A("not a database",I)}const f=new Map;function l(s){if(!f.has(s))throw new A("not a statement",I)}n.bind_collection=function(s,r){l(s);const t=Array.isArray(r),c=n.bind_parameter_count(s);for(let o=1;o<=c;++o){const u=t?o-1:n.bind_parameter_name(s,o),m=r[u];m!==void 0&&n.bind(s,o,m)}return F},n.bind=function(s,r,t){switch(l(s),typeof t){case"number":return t===(t|0)?n.bind_int(s,r,t):n.bind_double(s,r,t);case"string":return n.bind_text(s,r,t);default:return t instanceof Uint8Array||Array.isArray(t)?n.bind_blob(s,r,t):t===null?n.bind_null(s,r):typeof t=="bigint"?n.bind_int64(s,r,t):t===void 0?Tn:(console.warn("unknown binding converted to null",t),n.bind_null(s,r))}},n.bind_blob=function(){const s="sqlite3_bind_blob",r=e.cwrap(s,..._("nnnnn:n"));return function(t,c,o){l(t);const u=o.byteLength??o.length,m=e._sqlite3_malloc(u);e.HEAPU8.subarray(m).set(o);const q=r(t,c,m,u,i);return T(s,q,f.get(t))}}(),n.bind_parameter_count=function(){const r=e.cwrap("sqlite3_bind_parameter_count",..._("n:n"));return function(t){return l(t),r(t)}}(),n.bind_double=function(){const s="sqlite3_bind_double",r=e.cwrap(s,..._("nnn:n"));return function(t,c,o){l(t);const u=r(t,c,o);return T(s,u,f.get(t))}}(),n.bind_int=function(){const s="sqlite3_bind_int",r=e.cwrap(s,..._("nnn:n"));return function(t,c,o){if(l(t),o>2147483647||o<-2147483648)return W;const u=r(t,c,o);return T(s,u,f.get(t))}}(),n.bind_int64=function(){const s="sqlite3_bind_int64",r=e.cwrap(s,..._("nnnn:n"));return function(t,c,o){if(l(t),o>J||o<Z)return W;const u=o&4294967295n,m=o>>32n,q=r(t,c,Number(u),Number(m));return T(s,q,f.get(t))}}(),n.bind_null=function(){const s="sqlite3_bind_null",r=e.cwrap(s,..._("nn:n"));return function(t,c){l(t);const o=r(t,c);return T(s,o,f.get(t))}}(),n.bind_parameter_name=function(){const r=e.cwrap("sqlite3_bind_parameter_name",..._("n:s"));return function(t,c){return l(t),r(t,c)}}(),n.bind_text=function(){const s="sqlite3_bind_text",r=e.cwrap(s,..._("nnnnn:n"));return function(t,c,o){l(t);const u=b(o),m=r(t,c,u,-1,i);return T(s,m,f.get(t))}}(),n.changes=function(){const r=e.cwrap("sqlite3_changes",..._("n:n"));return function(t){return w(t),r(t)}}(),n.last_insert_id=function(){const r=e.cwrap("sqlite3_last_insert_rowid",..._("n:n"));return function(t){return w(t),r(t)}}(),n.close=function(){const s="sqlite3_close",r=e.cwrap(s,..._("n:n"),{async:k});return async function(t){w(t);const c=await r(t);return y.delete(t),T(s,c,t)}}(),n.column=function(s,r){l(s);const t=n.column_type(s,r);switch(t){case X:return n.column_blob(s,r);case j:return n.column_double(s,r);case K:const c=n.column_int(s,r),o=e.getTempRet0();return g(c,o);case Y:return null;case $:return n.column_text(s,r);default:throw new A("unknown type",t)}},n.column_blob=function(){const r=e.cwrap("sqlite3_column_blob",..._("nn:n"));return function(t,c){l(t);const o=n.column_bytes(t,c),u=r(t,c);return e.HEAPU8.subarray(u,u+o)}}(),n.column_bytes=function(){const r=e.cwrap("sqlite3_column_bytes",..._("nn:n"));return function(t,c){return l(t),r(t,c)}}(),n.column_count=function(){const r=e.cwrap("sqlite3_column_count",..._("n:n"));return function(t){return l(t),r(t)}}(),n.column_double=function(){const r=e.cwrap("sqlite3_column_double",..._("nn:n"));return function(t,c){return l(t),r(t,c)}}(),n.column_int=function(){const r=e.cwrap("sqlite3_column_int64",..._("nn:n"));return function(t,c){return l(t),r(t,c)}}(),n.column_int64=function(){const r=e.cwrap("sqlite3_column_int64",..._("nn:n"));return function(t,c){l(t);const o=r(t,c),u=e.getTempRet0();return p(o,u)}}(),n.column_name=function(){const r=e.cwrap("sqlite3_column_name",..._("nn:s"));return function(t,c){return l(t),r(t,c)}}(),n.column_names=function(s){const r=[],t=n.column_count(s);for(let c=0;c<t;++c)r.push(n.column_name(s,c));return r},n.column_text=function(){const r=e.cwrap("sqlite3_column_text",..._("nn:s"));return function(t,c){return l(t),r(t,c)}}(),n.column_type=function(){const r=e.cwrap("sqlite3_column_type",..._("nn:n"));return function(t,c){return l(t),r(t,c)}}(),n.create_function=function(s,r,t,c,o,u,m,q){if(w(s),u&&!m&&!q){const L=e.createFunction(s,r,t,c,o,u);return T("sqlite3_create_function",L,s)}if(!u&&m&&q){const L=e.createAggregate(s,r,t,c,o,m,q);return T("sqlite3_create_function",L,s)}throw new A("invalid function combination",I)},n.create_module=function(s,r,t,c){w(s);const o=e.createModule(s,r,t,c);return T("sqlite3_create_module",o,s)},n.data_count=function(){const r=e.cwrap("sqlite3_data_count",..._("n:n"));return function(t){return l(t),r(t)}}(),n.declare_vtab=function(){const r=e.cwrap("sqlite3_declare_vtab",..._("ns:n"));return function(t,c){const o=r(t,c);return T("sqlite3_declare_vtab",o)}}(),n.exec=async function(s,r,t){for await(const c of n.statements(s,r)){let o;for(;await n.step(c)===z;)if(t){o=o??n.column_names(c);const u=n.row(c);await t(u,o)}}return F},n.finalize=function(){const r=e.cwrap("sqlite3_finalize",..._("n:n"),{async:k});return async function(t){if(!f.has(t))return I;const c=await r(t);return f.get(t),f.delete(t),c}}(),n.get_autocommit=function(){const r=e.cwrap("sqlite3_get_autocommit",..._("n:n"));return function(t){return r(t)}}(),n.libversion=function(){const r=e.cwrap("sqlite3_libversion",..._(":s"));return function(){return r()}}(),n.libversion_number=function(){const r=e.cwrap("sqlite3_libversion_number",..._(":n"));return function(){return r()}}(),n.limit=function(){const r=e.cwrap("sqlite3_limit",..._("nnn:n"));return function(t,c,o){return r(t,c,o)}}(),n.open_v2=function(){const s="sqlite3_open_v2",r=e.cwrap(s,..._("snnn:n"),{async:k});return async function(t,c,o){c=c||Ln|qn,o=b(o),e.ccall("setup_powersync","int",[]);const u=await r(t,a[0],c,o),m=e.getValue(a[0],"*");return y.add(m),e._sqlite3_free(o),e.ccall("RegisterExtensionFunctions","void",["number"],[m]),T(s,u),m}}(),n.register_table_onchange_hook=function(s,r){e.ccall("register_table_update_hook","int",["number"],[s]),an[s]=function(t,c,o){const u=new DataView(e.HEAPU8.buffer);let m=0;for(;u.getUint8(c+m)!==0;)m++;const q=new Uint8Array(e.HEAPU8.buffer,c,m),L=new TextDecoder().decode(q);return r(t,L,o)}},n.prepare_v2=function(){const s="sqlite3_prepare_v2",r=e.cwrap(s,..._("nnnnn:n"),{async:k});return async function(t,c){const o=await r(t,c,-1,a[0],a[1]);T(s,o,t);const u=e.getValue(a[0],"*");return u?(f.set(u,t),{stmt:u,sql:e.getValue(a[1],"*")}):null}}(),n.progress_handler=function(s,r,t,c){w(s),e.progressHandler(s,r,t,c)},n.reset=function(){const s="sqlite3_reset",r=e.cwrap(s,..._("n:n"),{async:k});return async function(t){l(t);const c=await r(t);return T(s,c,f.get(t))}}(),n.result=function(s,r){switch(typeof r){case"number":r===(r|0)?n.result_int(s,r):n.result_double(s,r);break;case"string":n.result_text(s,r);break;default:if(r instanceof Uint8Array||Array.isArray(r))n.result_blob(s,r);else if(r===null)n.result_null(s);else{if(typeof r=="bigint")return n.result_int64(s,r);console.warn("unknown result converted to null",r),n.result_null(s)}break}},n.result_blob=function(){const r=e.cwrap("sqlite3_result_blob",..._("nnnn:n"));return function(t,c){const o=c.byteLength??c.length,u=e._sqlite3_malloc(o);e.HEAPU8.subarray(u).set(c),r(t,u,o,i)}}(),n.result_double=function(){const r=e.cwrap("sqlite3_result_double",..._("nn:n"));return function(t,c){r(t,c)}}(),n.result_int=function(){const r=e.cwrap("sqlite3_result_int",..._("nn:n"));return function(t,c){r(t,c)}}(),n.result_int64=function(){const r=e.cwrap("sqlite3_result_int64",..._("nnn:n"));return function(t,c){if(c>J||c<Z)return W;const o=c&4294967295n,u=c>>32n;r(t,Number(o),Number(u))}}(),n.result_null=function(){const r=e.cwrap("sqlite3_result_null",..._("n:n"));return function(t){r(t)}}(),n.result_text=function(){const r=e.cwrap("sqlite3_result_text",..._("nnnn:n"));return function(t,c){const o=b(c);r(t,o,-1,i)}}(),n.row=function(s){const r=[],t=n.data_count(s);for(let c=0;c<t;++c){const o=n.column(s,c);r.push(o?.buffer===e.HEAPU8.buffer?o.slice():o)}return r},n.set_authorizer=function(s,r,t){w(s);const c=e.setAuthorizer(s,r,t);return T("sqlite3_set_authorizer",c,s)},n.sql=function(){const r=e.cwrap("sqlite3_sql",..._("n:s"));return function(t){return l(t),r(t)}}(),n.statements=function(s,r){return async function*(){const t=n.str_new(s,r);let c={stmt:null,sql:n.str_value(t)};try{for(;c=await n.prepare_v2(s,c.sql);)yield c.stmt,n.finalize(c.stmt),c.stmt=null}finally{c?.stmt&&n.finalize(c.stmt),n.str_finish(t)}}()},n.step=function(){const s="sqlite3_step",r=e.cwrap(s,..._("n:n"),{async:k});return async function(t){l(t);const c=await r(t);return T(s,c,f.get(t),[z,on])}}();let E=0;const d=new Map;n.str_new=function(s,r=""){const t=e.lengthBytesUTF8(r),c=E++&4294967295,o={offset:e._sqlite3_malloc(t+1),bytes:t};return d.set(c,o),e.stringToUTF8(r,o.offset,o.bytes+1),c},n.str_appendall=function(s,r){if(!d.has(s))throw new A("not a string",I);const t=d.get(s),c=e.lengthBytesUTF8(r),o=t.bytes+c,u=e._sqlite3_malloc(o+1);e.HEAPU8.subarray(u,u+o+1).set(e.HEAPU8.subarray(t.offset,t.offset+t.bytes)),e.stringToUTF8(r,u+t.bytes,c+1),e._sqlite3_free(t.offset),t.offset=u,t.bytes=o,d.set(s,t)},n.str_finish=function(s){if(!d.has(s))throw new A("not a string",I);const r=d.get(s);d.delete(s),e._sqlite3_free(r.offset)},n.str_value=function(s){if(!d.has(s))throw new A("not a string",I);return d.get(s).offset},n.user_data=function(s){return e.getFunctionUserData(s)},n.value=function(s){const r=n.value_type(s);switch(r){case X:return n.value_blob(s);case j:return n.value_double(s);case K:const t=n.value_int(s),c=e.getTempRet0();return g(t,c);case Y:return null;case $:return n.value_text(s);default:throw new A("unknown type",r)}},n.value_blob=function(){const r=e.cwrap("sqlite3_value_blob",..._("n:n"));return function(t){const c=n.value_bytes(t),o=r(t);return e.HEAPU8.subarray(o,o+c)}}(),n.value_bytes=function(){const r=e.cwrap("sqlite3_value_bytes",..._("n:n"));return function(t){return r(t)}}(),n.value_double=function(){const r=e.cwrap("sqlite3_value_double",..._("n:n"));return function(t){return r(t)}}(),n.value_int=function(){const r=e.cwrap("sqlite3_value_int64",..._("n:n"));return function(t){return r(t)}}(),n.value_int64=function(){const r=e.cwrap("sqlite3_value_int64",..._("n:n"));return function(t){const c=r(t),o=e.getTempRet0();return p(c,o)}}(),n.value_text=function(){const r=e.cwrap("sqlite3_value_text",..._("n:s"));return function(t){return r(t)}}(),n.value_type=function(){const r=e.cwrap("sqlite3_value_type",..._("n:n"));return function(t){return r(t)}}(),n.vfs_register=function(s,r){const t=e.registerVFS(s,r);return T("sqlite3_vfs_register",t)};function T(s,r,t=null,c=[F]){if(c.includes(r))return r;const o=t?e.ccall("sqlite3_errmsg","string",["number"],[t]):s;throw new A(o,r)}return n}function _(e){const n=[],i=e.match(/([ns@]*):([nsv@])/);switch(i[2]){case"n":n.push("number");break;case"s":n.push("string");break;case"v":n.push(null);break}const h=[];for(let a of i[1])switch(a){case"n":h.push("number");break;case"s":h.push("string");break}return n.push(h),n}const An=new Error("request for lock canceled");var In=function(e,n,i,h){function a(b){return b instanceof i?b:new i(function(p){p(b)})}return new(i||(i=Promise))(function(b,p){function g(f){try{w(h.next(f))}catch(l){p(l)}}function y(f){try{w(h.throw(f))}catch(l){p(l)}}function w(f){f.done?b(f.value):a(f.value).then(g,y)}w((h=h.apply(e,n||[])).next())})};class xn{constructor(n,i=An){this._value=n,this._cancelError=i,this._weightedQueues=[],this._weightedWaiters=[]}acquire(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);return new Promise((i,h)=>{this._weightedQueues[n-1]||(this._weightedQueues[n-1]=[]),this._weightedQueues[n-1].push({resolve:i,reject:h}),this._dispatch()})}runExclusive(n,i=1){return In(this,void 0,void 0,function*(){const[h,a]=yield this.acquire(i);try{return yield n(h)}finally{a()}})}waitForUnlock(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);return new Promise(i=>{this._weightedWaiters[n-1]||(this._weightedWaiters[n-1]=[]),this._weightedWaiters[n-1].push(i),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(n){this._value=n,this._dispatch()}release(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);this._value+=n,this._dispatch()}cancel(){this._weightedQueues.forEach(n=>n.forEach(i=>i.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var n;for(let i=this._value;i>0;i--){const h=(n=this._weightedQueues[i-1])===null||n===void 0?void 0:n.shift();if(!h)continue;const a=this._value,b=i;this._value-=i,i=this._value+1,h.resolve([a,this._newReleaser(b)])}this._drainUnlockWaiters()}_newReleaser(n){let i=!1;return()=>{i||(i=!0,this.release(n))}}_drainUnlockWaiters(){for(let n=this._value;n>0;n--)this._weightedWaiters[n-1]&&(this._weightedWaiters[n-1].forEach(i=>i()),this._weightedWaiters[n-1]=[])}}var On=function(e,n,i,h){function a(b){return b instanceof i?b:new i(function(p){p(b)})}return new(i||(i=Promise))(function(b,p){function g(f){try{w(h.next(f))}catch(l){p(l)}}function y(f){try{w(h.throw(f))}catch(l){p(l)}}function w(f){f.done?b(f.value):a(f.value).then(g,y)}w((h=h.apply(e,n||[])).next())})};class kn{constructor(n){this._semaphore=new xn(1,n)}acquire(){return On(this,void 0,void 0,function*(){const[,n]=yield this._semaphore.acquire();return n})}runExclusive(n){return this._semaphore.runExclusive(()=>n())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}let M=1;async function Nn(e,n={useWebWorker:!0}){const{default:i}=await import("./wa-sqlite-async-BQPTkA7Y.js"),h=await i(),a=Sn(h),{IDBBatchAtomicVFS:b}=await import("./IDBBatchAtomicVFS-DbxA3CCg.js"),p=new b(e);a.vfs_register(p,!0);const g=await a.open_v2(e),y=new kn,w=new Map;a.register_table_onchange_hook(g,(s,r,t)=>{Array.from(w.values()).forEach(c=>c(s,r,t))});const f=async(s,r)=>l(async()=>E(s,r)),l=s=>y.runExclusive(s),E=async(s,r)=>{const t=[];for await(const u of a.statements(g,s)){let m;const q=r?[r]:[[]];for(const L of q){L.forEach((S,R,un)=>{typeof S=="boolean"&&(un[R]=S?1:0)}),a.reset(u),r&&a.bind_collection(u,L);const v=[];for(;await a.step(u)===z;){const S=a.row(u);v.push(S)}m=m??a.column_names(u),m.length&&t.push({columns:m,rows:v})}if(r)break}const c=[];for(const u of t)for(const m of u.rows){const q={};u.columns.forEach((L,v)=>{q[L]=m[v]}),c.push(q)}return{insertId:a.last_insert_id(g),rowsAffected:a.changes(g),rows:{_array:c,length:c.length}}},d=async(s,r)=>l(async()=>{let t=0;const c=a.str_new(g,s),o=a.str_value(c);try{await E("BEGIN TRANSACTION");const m=await a.prepare_v2(g,o);if(m===null)return{rowsAffected:0,rows:{_array:[],length:0}};const q=r||[];for(const L of q){for(let S=0;S<L.length;S++){const R=L[S];typeof R=="boolean"&&(L[S]=R?1:0)}a.reset(m.stmt),r&&a.bind_collection(m.stmt,L),await a.step(m.stmt)===on&&(t+=a.changes(g))}await a.finalize(m.stmt),await E("COMMIT")}catch{return await E("ROLLBACK"),{rowsAffected:0,rows:{_array:[],length:0}}}finally{a.str_finish(c)}return{rowsAffected:t,rows:{_array:[],length:0}}});if(n.useWebWorker){const s=r=>{const t=M++;return w.set(t,r),x(()=>{w.delete(t)})};return{execute:x(f),executeBatch:x(d),registerOnTableChange:x(s),close:x(()=>{a.close(g)})}}return{execute:f,executeBatch:d,registerOnTableChange:s=>{const r=M++;return w.set(r,s),()=>{w.delete(r)}},close:()=>a.close(g)}}V(async e=>x(await Nn(e)))})();export{Rn as S,F as a,Cn as b,Pn as c,Fn as d,vn as e,Qn as f,Hn as g,Vn as h,Wn as i,zn as j,Ln as k,Bn as l,Dn as m,Un as n,$n as o,Gn as p,Kn as q,jn as r,__tla};